<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}">

  {%- include head.html -%}

  <body>

    {%- include header.html -%}

    <!-- YouTube Background Music Player (hidden) -->
    <div id="youtube-container" 
         data-video-id="{{ site.background_music.youtube_video_id }}" 
         data-start-time="{{ site.background_music.start_timestamp | default: 0 }}" 
         style="position: absolute; top: -9999px; left: -9999px;"></div>

    {% if site.background_music.enabled %}
    <div class="music-controls">
      <button id="music-toggle" class="music-toggle-btn">Play Music</button>
      <div class="volume-container">
        <input type="range" id="volume-control" min="0" max="100" step="1" class="volume-slider">
      </div>
    </div>
    {% endif %}

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        {%- if page.layout == 'home' or page.url == '/' -%}
          <div class="home">
            {%- if page.title -%}
              <h1 class="page-heading">{{ page.title }}</h1>
            {%- endif -%}

            {%- assign categories = "" | split: "," -%}
            {%- for post in site.posts -%}
              {%- for category in post.categories -%}
                {%- unless categories contains category -%}
                  {%- assign categories = categories | push: category -%}
                {%- endunless -%}
              {%- endfor -%}
            {%- endfor -%}
            {%- assign categories = categories | sort -%}

            {%- if categories.size > 0 -%}
            <div class="category-filter" style="margin-bottom: 20px;">
              <span style="font-size: 0.9em; font-weight: bold;">Filter by category:</span>
              <a href="javascript:void(0);" class="category-link active" data-category="all" style="font-size: 0.8em; margin-left: 5px;">All</a>
              {%- for category in categories -%}
                <a href="javascript:void(0);" class="category-link" data-category="{{ category | join: '' | slugify | escape }}" style="font-size: 0.8em; margin-left: 5px;">{{ category | join: "" | escape }}</a>
              {%- endfor -%}
            </div>
            {%- endif -%}

            {% if site.posts.size > 0 %}
              <ul class="post-list">
                {% assign date_format = site.minima.date_format | default: "%b %-d, %Y" %}
                {% for post in site.posts %}
                  {%- assign post_categories_slugified = "" | split: "," -%}
                  {%- for category in post.categories -%}
                    {%- assign post_categories_slugified = post_categories_slugified | push: (category | join: "" | slugify) -%}
                  {%- endfor -%}
                  <li data-categories="{{ post_categories_slugified | join: ' ' }}">
                    <span class="post-meta">{{ post.date | date: date_format }}</span>
                    <h3>
                      <a class="post-link" href="{{ post.url | relative_url }}">
                        {{ post.title | escape }}
                      </a>
                    </h3>
                    {%- if site.show_excerpts -%}
                      {{ post.excerpt }}
                    {%- endif -%}
                  </li>
                {% endfor %}
              </ul>
            {% endif %}
          </div>
          <div class="card mt-4">
            <div class="card-body">
              <h3 class="card-title">About Me</h5>
              <p class="card-text">I'm interested in physics, maths, finance, and anything in-between. This blog contains short notes on these topics, heavily co-authored by LLM.</p>
            </div>
          </div>
        {%- else -%}
          {{ content }}
        {%- endif -%}
      </div>
    </main>

    {%- include footer.html -%}

    <script>
      function filterPosts(category) {
        const posts = document.querySelectorAll('.post-list li');
        const links = document.querySelectorAll('.category-link');
        
        links.forEach(link => {
          link.classList.remove('active');
          if (link.getAttribute('data-category') === category) {
            link.classList.add('active');
          }
        });

        posts.forEach(post => {
          const postCategories = post.getAttribute('data-categories').split(' ');
          if (category === 'all' || postCategories.includes(category)) {
            post.style.display = 'list-item';
          } else {
            post.style.display = 'none';
          }
        });
      }

      // Add event listeners to category links
      document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.category-link').forEach(link => {
          link.addEventListener('click', function() {
            filterPosts(this.getAttribute('data-category'));
          });
        });
      });
    </script>
    <style>
      .category-link.active {
        font-weight: bold;
        text-decoration: underline;
      }
      
      .music-controls {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
        background-color: rgba(74, 74, 74, 0.7);
        padding: 10px;
        border-radius: 5px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
      }
      
      .music-toggle-btn {
        padding: 8px 12px;
        background-color: #4a4a4a;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        opacity: 0.9;
        transition: opacity 0.3s;
        width: 100%;
      }
      
      .music-toggle-btn:hover {
        opacity: 1;
      }
      
      .volume-container {
        width: 100%;
      }
      
      .volume-slider {
        width: 100%;
        height: 5px;
        -webkit-appearance: none;
        appearance: none;
        background: #d3d3d3;
        outline: none;
        border-radius: 5px;
      }
      
      .volume-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 15px;
        height: 15px;
        border-radius: 50%;
        background: white;
        cursor: pointer;
      }
      
      .volume-slider::-moz-range-thumb {
        width: 15px;
        height: 15px;
        border-radius: 50%;
        background: white;
        cursor: pointer;
        border: none;
      }
    </style>
    
    <script src="{{ '/assets/js/youtube-audio-player.js' | relative_url }}"></script>
  </body>

</html> 